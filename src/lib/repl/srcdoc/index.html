<!DOCTYPE html>
<html>
	<head>
		<style>
			html,
			body {
				height: 100%;
				width: 100%;
				margin: 0;
				padding: 0;
			}
		</style>

		<script type="module">
			import { n as mount } from 'https://jspm.dev/npm:svelte@5.0.0-next.11/_/ItiZK9df.js';

			let currentAppCleanup = null;
			let app = null;

			function cleanupPreviousApp() {
				if (currentAppCleanup) {
					currentAppCleanup();
					currentAppCleanup = null;
				}

				const styles = document.querySelectorAll('style[id^="svelte-"]');
				styles.forEach((style) => style.remove());

				if (app) {
					app = null;
				}
			}

			function update(source) {
				console.log('update');
				cleanupPreviousApp();

				// Create a container for the Svelte component
				const container = document.createElement('div');
				document.body.appendChild(container);

				// Mount the new component
				const blob = new Blob([source], { type: 'text/javascript' });
				const url = URL.createObjectURL(blob);
				console.log(url);

				import(url)
					.then(({ default: App }) => {
						console.log(App);
						// const [accessors, destroy] = mount(App, { target: container });
						const app = mount(App, { target: document.getElementById('app') });
						console.log(app);
						// currentAppCleanup = destroy;
					})
					.catch((error) => {
						console.error('Error mounting component:', error);
					});
			}

			window.addEventListener(
				'message',
				(event) => {
					console.log('window event listener');
					update(event.data);
				},
				false
			);
		</script>
		<!-- <script src="https://cdn.tailwindcss.com"></script> -->
	</head>
	<body>
		<div id="app"></div>
	</body>
</html>
